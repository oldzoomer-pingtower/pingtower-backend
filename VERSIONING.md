# Подходы к версионированию API

## 1. Общие принципы версионирования

API системы мониторинга PingTower использует версионирование для управления изменениями и обеспечения обратной совместимости. Версионирование позволяет постепенно вводить новые функции и улучшения, не нарушая работу существующих клиентов.

## 2. Стратегия версионирования

### 2.1. Версионирование через URL

API использует версионирование через URL:

```text
https://api.example.com/v1/
```

Это позволяет поддерживать несколько версий API одновременно и обеспечивает явное указание версии в каждом запросе.

### 2.2. Формат номера версии

Номер версии следует формату SemVer (Semantic Versioning) MAJOR.MINOR.PATCH:

- **MAJOR** - увеличивается при внесении критических изменений, нарушающих обратную совместимость.
- **MINOR** - увеличивается при добавлении новой функциональности с сохранением обратной совместимости.
- **PATCH** - увеличивается при внесении исправлений ошибок с сохранением обратной совместимости.

Примеры версий:

- v1.0.0 - первая стабильная версия API
- v1.1.0 - добавлена новая функциональность
- v1.1.1 - исправлена ошибка
- v2.0.0 - критические изменения, нарушающие обратную совместимость

### 2.3. Уровни изменений

#### Критические изменения (MAJOR)

- Удаление эндпоинтов
- Изменение структуры ответов, нарушающее совместимость
- Изменение значений перечислений (enums)
- Изменение обязательных параметров запроса

#### Несущественные изменения (MINOR)

- Добавление новых эндпоинтов
- Добавление новых необязательных параметров запроса
- Добавление новых полей в ответы
- Добавление новых значений перечислений (enums)

#### Исправления (PATCH)

- Исправление ошибок
- Оптимизация производительности
- Улучшение документации

## 3. Жизненный цикл версий

### 3.1. Стабильные версии

Стабильные версии API (например, v1.0.0, v2.0.0) поддерживаются в течение определенного периода времени и получают исправления критических ошибок и обновления безопасности.

### 3.2. Бета-версии

Бета-версии (например, v1.0.0-beta.1) предоставляются для тестирования новых функций. Они могут содержать нестабильную функциональность и не рекомендуются для использования в производственной среде.

### 3.3. Устаревшие версии

Когда новая MAJOR версия API становится доступной, предыдущая версия помечается как устаревшая. Устаревшие версии продолжают поддерживаться в течение определенного периода времени (обычно 12-18 месяцев) для обеспечения плавного перехода клиентов на новую версию.

### 3.4. Прекращение поддержки

После окончания срока поддержки устаревшие версии API прекращают поддерживаться. Клиенты должны перейти на более новые версии API до этого срока.

## 4. Управление переходом между версиями

### 4.1. Уведомления об изменениях

Клиенты API уведомляются о предстоящих изменениях и прекращении поддержки версий через:

- Рассылки по электронной почте
- Объявления в блоге
- Уведомления в API (например, заголовки Warning)

### 4.2. Миграция клиентов

Для облегчения миграции клиентов на новые версии API предоставляются:

- Подробная документация по изменениям
- Инструменты для автоматической миграции (если возможно)
- Примеры кода для новых версий
- Техническая поддержка

### 4.3. Обратная совместимость

Новая MINOR или PATCH версия API всегда сохраняет обратную совместимость с предыдущими версиями. Это означает, что клиенты, использующие старую версию API, могут обновиться на новую версию без изменений в своем коде.

## 5. Документирование версий

### 5.1. Документация для каждой версии

Для каждой версии API предоставляется отдельная документация, доступная по адресу:

```text
https://api.example.com/v1/docs
https://api.example.com/v2/docs
```

### 5.2. История изменений

Для каждой версии API ведется история изменений (changelog), в которой описываются:

- Все внесенные изменения
- Причины изменений
- Рекомендации по миграции

### 5.3. Сравнение версий

Предоставляется возможность сравнения различных версий API для понимания различий между ними.

## 6. Тестирование версий

### 6.1. Тестирование новых версий

Все новые версии API тщательно тестируются в тестовой среде перед выпуском в производство.

### 6.2. Регрессионное тестирование

При выпуске новых версий проводится регрессионное тестирование для обеспечения того, что существующая функциональность не нарушена.

## 7. Мониторинг использования версий

### 7.1. Аналитика использования

Система мониторит использование различных версий API для:

- Определения популярности различных версий
- Планирования прекращения поддержки устаревших версий
- Понимания потребностей клиентов

### 7.2. Уведомления о низком использовании

Если использование определенной версии API падает ниже определенного порога, это может повлиять на решение о прекращении ее поддержки.
